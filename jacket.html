<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Should I Wear a Jacket on Hawk Today?</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f8ff;
            color: #333;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }
        header {
            background-color: #4682b4;
            color: white;
            padding: 20px;
            text-align: center;
        }
        main {
            flex: 1;
            padding: 40px;
            text-align: center;
        }
        footer {
            background-color: #4682b4;
            color: white;
            padding: 10px;
            text-align: center;
        }
        h1 {
            font-size: 2em;
            margin-bottom: 20px;
        }
        .answer {
            font-size: 1.5em;
            color: #2e8b57;
        }
    </style>
</head>
<body>

<header>
    <h1>Should I Wear a Jacket Today on Hawk Hill?</h1>
</header>

<main>
    <p id="recommendation">Loading...</p>

    <script>
        // Simple decision rule 
        function chooseOutfit(temp, wind, cloud, rain) {
            if (temp < 45) return "pants";
            if (temp < 50 && temp >= 45) return "jacket";
            if (temp < 55 && temp >= 50) {
                if (rain < 20 && cloud < 30 && wind < 15) return "long sleeve";
                else return "jacket";
            }
            if (temp >= 55) {
                if (rain < 20 && cloud < 30 && wind < 15) return "short sleeve";
                else return "long sleeve";
            }
            if (temp >= 60) return "short sleeve";
        }

        async function updateRecommendation() {
            try {
                // Fetch weather data from Open-Meteo
                const hoursToFetch = 2;
                const now = new Date();
                
                const startTime = now.toISOString().slice(0,16); // "YYYY-MM-DDTHH:mm"
                const endTime = new Date(now.getTime() + hoursToFetch*60*60*1000).toISOString().slice(0,16);

                console.log("Start (UTC):", startTime);
                console.log("End   (UTC):", endTime);

                const timezone = "America/Los_Angeles";
                const url = `https://api.open-meteo.com/v1/forecast?latitude=37.83&longitude=-122.48&hourly=temperature_2m,cloudcover,windspeed_10m,precipitation_probability&start=${startTime}&end=${endTime}&timezone=${timezone}`;
                const response = await fetch(url)
                const data = await response.json();
                const end = new Date(now.getTime() + hoursToFetch*60*60*1000);


                const hoursData = data.hourly.time
                    .map((t, i) => ({
                        time: t,
                        temp: data.hourly.temperature_2m[i],
                        cloud: data.hourly.cloudcover[i],
                        wind: data.hourly.windspeed_10m[i],
                        rain: data.hourly.precipitation_probability[i]
                    }))
                    .filter(d => new Date(d.time) >= now && new Date(d.time) <= end);


                const tempsF = hoursData.hourly.temperature_2m.map(tempC => tempC * 9 / 5 + 32);
                const clouds = hoursData.hourly.cloudcover;
                const windsMph = hoursData.hourly.windspeed_10m.map(speedKmh => speedKmh * 0.621371);
                const rains = hoursData.hourly.precipitation_probability;

                console.log("Raw data:", data.hourly);
                console.log("Temps (F):", tempsF);
                console.log("Cloud cover (%):", clouds);
                console.log("Wind speed (mph):", windsMph);
                console.log("Rain probability (%):", rains);

                const minTemp = Math.min(...tempsF);
                const minCloud = Math.min(...clouds);
                const maxWind = Math.max(...windsMph);
                const maxRain = Math.max(...rains);

                const outfit = chooseOutfit(minTemp, maxWind, minCloud, maxRain);
                const message = outfit === "jacket" 
                    ? "Yes!" 
                    : `No, you should wear "${outfit}"`;
                document.getElementById("recommendation").innerText = message;
            } catch (err) {
                console.error(err);
                document.getElementById("recommendation").innerText = "Error fetching weather data";
            }
        }

        // Initial call
        updateRecommendation();

        // Update every 20 minutes (20*60*1000 ms)
        setInterval(updateRecommendation, 20 * 60 * 1000);
    </script>
</main>

<footer>
    <p>2025</p>
</footer>

</body>
</html>

